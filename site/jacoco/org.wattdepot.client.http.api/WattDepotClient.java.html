<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>WattDepotClient.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">WattDepot</a> &gt; <a href="index.html" class="el_package">org.wattdepot.client.http.api</a> &gt; <span class="el_source">WattDepotClient.java</span></div><h1>WattDepotClient.java</h1><pre class="source lang-java linenums">/**
 * WattDepotClient.java This file is part of WattDepot.
 *
 * Copyright (C) 2013  Cam Moore
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package org.wattdepot.client.http.api;

import java.util.Date;
import java.util.logging.Logger;

import javax.xml.datatype.DatatypeConfigurationException;

import org.restlet.data.ChallengeResponse;
import org.restlet.data.ChallengeScheme;
import org.restlet.data.Reference;
import org.restlet.resource.ClientResource;
import org.restlet.resource.ResourceException;
import org.wattdepot.client.ClientProperties;
import org.wattdepot.client.WattDepotInterface;
import org.wattdepot.common.domainmodel.CollectorProcessDefinition;
import org.wattdepot.common.domainmodel.CollectorProcessDefinitionList;
import org.wattdepot.common.domainmodel.Depository;
import org.wattdepot.common.domainmodel.DepositoryList;
import org.wattdepot.common.domainmodel.InterpolatedValue;
import org.wattdepot.common.domainmodel.InterpolatedValueList;
import org.wattdepot.common.domainmodel.Labels;
import org.wattdepot.common.domainmodel.Measurement;
import org.wattdepot.common.domainmodel.MeasurementList;
import org.wattdepot.common.domainmodel.MeasurementPruningDefinition;
import org.wattdepot.common.domainmodel.MeasurementPruningDefinitionList;
import org.wattdepot.common.domainmodel.MeasurementType;
import org.wattdepot.common.domainmodel.MeasurementTypeList;
import org.wattdepot.common.domainmodel.Sensor;
import org.wattdepot.common.domainmodel.SensorGroup;
import org.wattdepot.common.domainmodel.SensorGroupList;
import org.wattdepot.common.domainmodel.SensorList;
import org.wattdepot.common.domainmodel.SensorModel;
import org.wattdepot.common.domainmodel.SensorModelList;
import org.wattdepot.common.exception.BadCredentialException;
import org.wattdepot.common.exception.IdNotFoundException;
import org.wattdepot.common.exception.MeasurementGapException;
import org.wattdepot.common.exception.MeasurementTypeException;
import org.wattdepot.common.exception.NoMeasurementException;
import org.wattdepot.common.http.api.CollectorProcessDefinitionPutResource;
import org.wattdepot.common.http.api.CollectorProcessDefinitionResource;
import org.wattdepot.common.http.api.CollectorProcessDefinitionsResource;
import org.wattdepot.common.http.api.DepositoriesResource;
import org.wattdepot.common.http.api.DepositoryMeasurementPutResource;
import org.wattdepot.common.http.api.DepositoryMeasurementResource;
import org.wattdepot.common.http.api.DepositoryMeasurementsResource;
import org.wattdepot.common.http.api.DepositoryPutResource;
import org.wattdepot.common.http.api.DepositoryResource;
import org.wattdepot.common.http.api.DepositorySensorsResource;
import org.wattdepot.common.http.api.DepositoryValueResource;
import org.wattdepot.common.http.api.DepositoryValuesResource;
import org.wattdepot.common.http.api.MeasurementPruningDefinitionPutResource;
import org.wattdepot.common.http.api.MeasurementPruningDefinitionResource;
import org.wattdepot.common.http.api.MeasurementPruningDefinitionsResource;
import org.wattdepot.common.http.api.MeasurementTypePutResource;
import org.wattdepot.common.http.api.MeasurementTypeResource;
import org.wattdepot.common.http.api.MeasurementTypesResource;
import org.wattdepot.common.http.api.SensorGroupPutResource;
import org.wattdepot.common.http.api.SensorGroupResource;
import org.wattdepot.common.http.api.SensorGroupsResource;
import org.wattdepot.common.http.api.SensorModelPutResource;
import org.wattdepot.common.http.api.SensorModelResource;
import org.wattdepot.common.http.api.SensorModelsResource;
import org.wattdepot.common.http.api.SensorPutResource;
import org.wattdepot.common.http.api.SensorResource;
import org.wattdepot.common.http.api.SensorsResource;
import org.wattdepot.common.util.DateConvert;
import org.wattdepot.common.util.UnitsHelper;
import org.wattdepot.common.util.logger.LoggerUtil;

/**
 * WattDepotClient - high-level Java implementation that communicates with a
 * WattDepot server. It implements the WattDepotInterface that hides the HTTP
 * Labels.
 * 
 * 
 * @author Cam Moore
 * 
 */
public class WattDepotClient implements WattDepotInterface {

  /** The URI for the WattDepot server. */
  private String wattDepotUri;
  /** The HTTP authentication approach. */
<span class="fc" id="L102">  private ChallengeScheme scheme = ChallengeScheme.HTTP_BASIC;</span>
  /** The credentials for this client. */
  private ChallengeResponse authentication;
  /** The Group this client belongs to. */
  private String organizationId;
  /** The logger for this client. */
  private Logger logger;
  /** The client properties. */
  private ClientProperties properties;

  /**
   * Creates a new WattDepotClient.
   * 
   * @param serverUri The URI of the WattDepot server (e.g.
   *        &quot;http://server.wattdepot.org/&quot;)
   * @param username The name of the user. The user must be defined in the
   *        WattDepot server.
   * @param orgId the organization the user is in.
   * @param password The password for the user.
   * @throws BadCredentialException If the user or password don't match the
   *         credentials on the WattDepot server.
   */
  public WattDepotClient(String serverUri, String username, String orgId, String password)
<span class="fc" id="L125">      throws BadCredentialException {</span>
    // ensure that the UnitsHelper class is loaded.
<span class="fc" id="L127">    new UnitsHelper();</span>
<span class="fc" id="L128">    this.properties = new ClientProperties();</span>
<span class="fc" id="L129">    this.logger = Logger.getLogger(&quot;org.wattdepot.client&quot;);</span>
<span class="fc" id="L130">    LoggerUtil.setLoggingLevel(this.logger, properties.get(ClientProperties.LOGGING_LEVEL_KEY));</span>
<span class="fc" id="L131">    LoggerUtil.useConsoleHandler();</span>
<span class="fc" id="L132">    logger.finest(&quot;Client &quot; + serverUri + &quot;, &quot; + username + &quot;, &quot; + password);</span>
<span class="fc" id="L133">    this.authentication = new ChallengeResponse(this.scheme, username, password);</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">    if (serverUri == null) {</span>
<span class="fc" id="L135">      throw new IllegalArgumentException(&quot;serverUri cannot be null&quot;);</span>
    }
<span class="fc bfc" id="L137" title="All 2 branches covered.">    if (!serverUri.endsWith(&quot;/&quot;)) {</span>
<span class="fc" id="L138">      throw new IllegalArgumentException(&quot;serverUri must end with '/'&quot;);</span>
    }
<span class="fc" id="L140">    this.wattDepotUri = serverUri + Labels.WATTDEPOT + &quot;/&quot;;</span>

<span class="fc" id="L142">    ClientResource client = null;</span>
<span class="fc" id="L143">    client = makeClient(orgId + &quot;/&quot;);</span>
    try {
<span class="fc" id="L145">      client.head();</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">      if (client.getLocationRef() != null) {</span>
<span class="nc" id="L147">        String path = client.getLocationRef().getPath();</span>
<span class="nc" id="L148">        path = path.substring(0, path.length() - 1);</span>
<span class="nc" id="L149">        int lastSlash = path.lastIndexOf('/') + 1;</span>
<span class="nc" id="L150">        organizationId = path.substring(lastSlash);</span>
<span class="nc" id="L151">      }</span>
      else {
<span class="fc" id="L153">        organizationId = orgId;</span>
      }
<span class="fc" id="L155">      client.release();</span>
    }
<span class="fc" id="L157">    catch (ResourceException e) {</span>
<span class="fc" id="L158">      throw new BadCredentialException(e.getMessage() + &quot; username and or password are not corect.&quot;);</span>
<span class="fc" id="L159">    }</span>
<span class="fc" id="L160">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#deleteCollectorProcessDefinition
   * (org.wattdepot .datamodel.CollectorProcessDefinition)
   */
  @Override
  public void deleteCollectorProcessDefinition(CollectorProcessDefinition process)
      throws IdNotFoundException {
<span class="fc" id="L172">    ClientResource client = makeClient(this.organizationId + &quot;/&quot;</span>
        + Labels.COLLECTOR_PROCESS_DEFINITION + &quot;/&quot; + process.getId());
<span class="fc" id="L174">    CollectorProcessDefinitionResource resource = client</span>
        .wrap(CollectorProcessDefinitionResource.class);
    try {
<span class="fc" id="L177">      resource.remove();</span>
    }
<span class="fc" id="L179">    catch (ResourceException e) {</span>
<span class="fc" id="L180">      throw new IdNotFoundException(process + &quot; is not stored in WattDepot.&quot;);</span>
    }
    finally {
<span class="fc" id="L183">      client.release();</span>
<span class="fc" id="L184">    }</span>
<span class="fc" id="L185">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#deleteDepository(org.wattdepot
   * .datamodel.Depository)
   */
  @Override
  public void deleteDepository(Depository depository) throws IdNotFoundException {
<span class="fc" id="L195">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
        + depository.getId());
<span class="fc" id="L197">    DepositoryResource resource = client.wrap(DepositoryResource.class);</span>
    try {
<span class="fc" id="L199">      resource.remove();</span>
    }
<span class="fc" id="L201">    catch (ResourceException e) {</span>
<span class="fc" id="L202">      throw new IdNotFoundException(depository + &quot; is not stored in WattDepot.&quot;);</span>
    }
    finally {
<span class="fc" id="L205">      client.release();</span>
<span class="fc" id="L206">    }</span>
<span class="fc" id="L207">  }</span>

  @Override
  public void deleteMeasurementPruningDefinition(MeasurementPruningDefinition gcd) throws IdNotFoundException {
<span class="fc" id="L211">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.MEASUREMENT_PRUNING_DEFINITION + &quot;/&quot;</span>
        + gcd.getId());
<span class="fc" id="L213">    MeasurementPruningDefinitionResource resource = client.wrap(MeasurementPruningDefinitionResource.class);</span>
    try {
<span class="fc" id="L215">      resource.remove();</span>
    }
<span class="fc" id="L217">    catch (ResourceException e) {</span>
<span class="fc" id="L218">      throw new IdNotFoundException(gcd + &quot;is not stored in WattDepot&quot;);</span>
    }
    finally {
<span class="fc" id="L221">      client.release();</span>
<span class="fc" id="L222">    }</span>
<span class="fc" id="L223">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#deleteMeasurement(org.wattdepot
   * .datamodel.Depository, org.wattdepot.datamodel.Measurement)
   */
  @Override
  public void deleteMeasurement(Depository depository, Measurement measurement)
      throws IdNotFoundException {
<span class="fc" id="L235">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
        + depository.getId() + &quot;/&quot; + Labels.MEASUREMENT + &quot;/&quot; + measurement.getId());
<span class="fc" id="L237">    DepositoryMeasurementResource resource = client.wrap(DepositoryMeasurementResource.class);</span>
    try {
<span class="fc" id="L239">      resource.remove();</span>
    }
<span class="fc" id="L241">    catch (ResourceException e) {</span>
<span class="fc" id="L242">      throw new IdNotFoundException(measurement + &quot; is not stored in WattDepot.&quot;);</span>
<span class="fc" id="L243">    }</span>
<span class="fc" id="L244">    client.release();</span>
<span class="fc" id="L245">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#deleteMeasurementType(org.wattdepot
   * .datamodel.MeasurementType)
   */
  @Override
  public void deleteMeasurementType(MeasurementType type) throws IdNotFoundException {
<span class="fc" id="L256">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.MEASUREMENT_TYPE + &quot;/&quot;</span>
        + type.getId());
<span class="fc" id="L258">    MeasurementTypeResource resource = client.wrap(MeasurementTypeResource.class);</span>
    try {
<span class="fc" id="L260">      resource.remove();</span>
    }
<span class="fc" id="L262">    catch (ResourceException e) {</span>
<span class="fc" id="L263">      throw new IdNotFoundException(type + &quot; is not stored in WattDepot.&quot;);</span>
<span class="fc" id="L264">    }</span>
<span class="fc" id="L265">    client.release();</span>
<span class="fc" id="L266">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#deleteSensor(org.wattdepot.datamodel
   * .Sensor)
   */
  @Override
  public void deleteSensor(Sensor sensor) throws IdNotFoundException {
<span class="fc" id="L277">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR + &quot;/&quot;</span>
        + sensor.getId());
<span class="fc" id="L279">    SensorResource resource = client.wrap(SensorResource.class);</span>
    try {
<span class="fc" id="L281">      resource.remove();</span>
    }
<span class="fc" id="L283">    catch (ResourceException e) {</span>
<span class="fc" id="L284">      throw new IdNotFoundException(sensor + &quot; is not stored in WattDepot.&quot;);</span>
<span class="fc" id="L285">    }</span>
<span class="fc" id="L286">    client.release();</span>
<span class="fc" id="L287">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#deleteSensorGroup(org.wattdepot
   * .datamodel.SensorGroup)
   */
  @Override
  public void deleteSensorGroup(SensorGroup group) throws IdNotFoundException {
<span class="fc" id="L298">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR_GROUP + &quot;/&quot;</span>
        + group.getId());
<span class="fc" id="L300">    SensorGroupResource resource = client.wrap(SensorGroupResource.class);</span>
    try {
<span class="fc" id="L302">      resource.remove();</span>
    }
<span class="fc" id="L304">    catch (ResourceException e) {</span>
<span class="fc" id="L305">      throw new IdNotFoundException(group + &quot; is not stored in WattDepot.&quot;);</span>
    }
    finally {
<span class="fc" id="L308">      client.release();</span>
<span class="fc" id="L309">    }</span>
<span class="fc" id="L310">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#deleteSensorModel(org.wattdepot
   * .datamodel.SensorModel)
   */
  @Override
  public void deleteSensorModel(SensorModel model) throws IdNotFoundException {
<span class="fc" id="L321">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.SENSOR_MODEL + &quot;/&quot;</span>
        + model.getId());
<span class="fc" id="L323">    SensorModelResource resource = client.wrap(SensorModelResource.class);</span>
    try {
<span class="fc" id="L325">      resource.remove();</span>
    }
<span class="fc" id="L327">    catch (ResourceException e) {</span>
<span class="fc" id="L328">      throw new IdNotFoundException(model + &quot; is not stored in WattDepot.&quot;);</span>
    }
    finally {
<span class="fc" id="L331">      client.release();</span>
<span class="fc" id="L332">    }</span>
<span class="fc" id="L333">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getCollectorProcessDefinition(java
   * .lang .String)
   */
  @Override
  public CollectorProcessDefinition getCollectorProcessDefinition(String id)
      throws IdNotFoundException {
<span class="fc" id="L345">    ClientResource client = makeClient(this.organizationId + &quot;/&quot;</span>
        + Labels.COLLECTOR_PROCESS_DEFINITION + &quot;/&quot; + id);
<span class="fc" id="L347">    CollectorProcessDefinitionResource resource = client</span>
        .wrap(CollectorProcessDefinitionResource.class);
    try {
<span class="fc" id="L350">      CollectorProcessDefinition ret = resource.retrieve();</span>
<span class="fc" id="L351">      client.release();</span>
<span class="fc" id="L352">      return ret;</span>
    }
<span class="fc" id="L354">    catch (ResourceException e) {</span>
<span class="fc" id="L355">      throw new IdNotFoundException(id + &quot; is not a known CollectorProcessDefinition. &quot;);</span>
    }
    finally {
<span class="pc bpc" id="L358" title="2 of 4 branches missed.">      if (client != null) {</span>
<span class="fc" id="L359">        client.release();</span>
      }
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getCollectorProcessDefinitions()
   */
  @Override
  public CollectorProcessDefinitionList getCollectorProcessDefinitions() {
<span class="fc" id="L372">    ClientResource client = makeClient(this.organizationId + &quot;/&quot;</span>
        + Labels.COLLECTOR_PROCESS_DEFINITIONS + &quot;/&quot;);
<span class="fc" id="L374">    CollectorProcessDefinitionsResource resource = client</span>
        .wrap(CollectorProcessDefinitionsResource.class);
<span class="fc" id="L376">    CollectorProcessDefinitionList ret = resource.retrieve();</span>
<span class="fc" id="L377">    client.release();</span>
<span class="fc" id="L378">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getDepositories()
   */
  @Override
  public DepositoryList getDepositories() {
<span class="fc" id="L388">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORIES + &quot;/&quot;);</span>
<span class="fc" id="L389">    DepositoriesResource resource = client.wrap(DepositoriesResource.class);</span>
<span class="fc" id="L390">    DepositoryList ret = null;</span>
    try {
<span class="fc" id="L392">      ret = resource.retrieve();</span>
    }
    finally {
<span class="pc" id="L395">      client.release();</span>
<span class="fc" id="L396">    }</span>
<span class="fc" id="L397">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getDepository(java.lang.String)
   */
  @Override
  public Depository getDepository(String id) throws IdNotFoundException {
<span class="fc" id="L408">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + id);</span>
<span class="fc" id="L409">    DepositoryResource resource = client.wrap(DepositoryResource.class);</span>
<span class="fc" id="L410">    Depository ret = null;</span>
    try {
<span class="fc" id="L412">      ret = resource.retrieve();</span>
    }
<span class="fc" id="L414">    catch (ResourceException e) {</span>
<span class="fc" id="L415">      throw new IdNotFoundException(id + &quot; is not a known Depository id.&quot;);</span>
    }
    finally {
<span class="fc" id="L418">      client.release();</span>
<span class="fc" id="L419">    }</span>
<span class="fc" id="L420">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getDepositorySensors(java.lang.
   * String)
   */
  @Override
  public SensorList getDepositorySensors(String id) throws IdNotFoundException {
<span class="fc" id="L432">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + id</span>
        + &quot;/&quot; + Labels.SENSORS + &quot;/&quot;);
<span class="fc" id="L434">    DepositorySensorsResource resource = client.wrap(DepositorySensorsResource.class);</span>
<span class="fc" id="L435">    SensorList ret = null;</span>
    try {
<span class="fc" id="L437">      ret = resource.retrieve();</span>
    }
<span class="nc" id="L439">    catch (ResourceException e) {</span>
<span class="nc" id="L440">      throw new IdNotFoundException(id + &quot; is not a known Depository id.&quot;);</span>
    }
    finally {
<span class="pc" id="L443">      client.release();</span>
<span class="fc" id="L444">    }</span>
<span class="fc" id="L445">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getEarliestMeasurement(org.wattdepot
   * .common.domainmodel.Depository, org.wattdepot.common.domainmodel.Sensor)
   */
  @Override
  public InterpolatedValue getEarliestValue(Depository depository, Sensor sensor) {
<span class="fc" id="L457">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
        + depository.getId() + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + sensor.getId()
        + &quot;&amp;earliest=true&quot;);
<span class="fc" id="L460">    DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L461">    InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L462">    client.release();</span>
<span class="fc" id="L463">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getEarliestValue(org.wattdepot.
   * common.domainmodel.Depository,
   * org.wattdepot.common.domainmodel.SensorGroup)
   */
  @Override
  public InterpolatedValue getEarliestValue(Depository depository, SensorGroup group) {
<span class="fc" id="L476">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
        + depository.getId() + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + group.getId()
        + &quot;&amp;earliest=true&quot;);
<span class="fc" id="L479">    DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L480">    InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L481">    client.release();</span>
<span class="fc" id="L482">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getMeasurementPruningDefinition(
   * java.lang.String)
   */
  @Override
  public MeasurementPruningDefinition getMeasurementPruningDefinition(String id)
      throws IdNotFoundException {
<span class="fc" id="L495">    ClientResource client = makeClient(this.organizationId + &quot;/&quot;</span>
        + Labels.MEASUREMENT_PRUNING_DEFINITION + &quot;/&quot; + id);
<span class="fc" id="L497">    MeasurementPruningDefinitionResource resource = client</span>
        .wrap(MeasurementPruningDefinitionResource.class);
    MeasurementPruningDefinition ret;
    try {
<span class="fc" id="L501">      ret = resource.retrieve();</span>
    }
<span class="fc" id="L503">    catch (ResourceException e) {</span>
<span class="fc" id="L504">      throw new IdNotFoundException(id + &quot; is not a known MeasurementPruningDefinition id.&quot;);</span>
    }
    finally {
<span class="fc" id="L507">      client.release();</span>
<span class="fc" id="L508">    }</span>
<span class="fc" id="L509">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getMeasurementPruningDefinitions()
   */
  @Override
  public MeasurementPruningDefinitionList getMeasurementPruningDefinitions() {
<span class="fc" id="L520">    ClientResource client = makeClient(this.organizationId + &quot;/&quot;</span>
        + Labels.MEASUREMENT_PRUNING_DEFINITIONS + &quot;/&quot;);
<span class="fc" id="L522">    MeasurementPruningDefinitionsResource resource = client</span>
        .wrap(MeasurementPruningDefinitionsResource.class);
<span class="fc" id="L524">    MeasurementPruningDefinitionList ret = resource.retrieve();</span>
<span class="fc" id="L525">    client.release();</span>
<span class="fc" id="L526">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getLatestMeasurement(org.wattdepot
   * .common.domainmodel.Depository, org.wattdepot.common.domainmodel.Sensor)
   */
  @Override
  public InterpolatedValue getLatestValue(Depository depository, Sensor sensor) {
<span class="fc" id="L538">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
        + depository.getId() + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + sensor.getId()
        + &quot;&amp;latest=true&quot;);
<span class="fc" id="L541">    DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L542">    InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L543">    client.release();</span>
<span class="fc" id="L544">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getLatestValue(org.wattdepot.common
   * .domainmodel.Depository, org.wattdepot.common.domainmodel.SensorGroup)
   */
  @Override
  public InterpolatedValue getLatestValue(Depository depository, SensorGroup group) {
<span class="fc" id="L556">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
        + depository.getId() + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + group.getId()
        + &quot;&amp;latest=true&quot;);
<span class="fc" id="L559">    DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L560">    InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L561">    client.release();</span>
<span class="fc" id="L562">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getMeasurements(org.wattdepot
   * .datamodel.Depository, org.wattdepot.datamodel.Sensor, java.util.Date,
   * java.util.Date)
   */
  @Override
  public MeasurementList getMeasurements(Depository depository, Sensor sensor, Date start, Date end) {
    try {
<span class="fc" id="L575">      ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
          + depository.getId() + &quot;/&quot; + Labels.MEASUREMENTS + &quot;/&quot; + &quot;?sensor=&quot; + sensor.getId()
          + &quot;&amp;start=&quot; + DateConvert.convertDate(start) + &quot;&amp;end=&quot; + DateConvert.convertDate(end));
<span class="fc" id="L578">      DepositoryMeasurementsResource resource = client.wrap(DepositoryMeasurementsResource.class);</span>
<span class="fc" id="L579">      MeasurementList ret = resource.retrieve();</span>
<span class="fc" id="L580">      client.release();</span>
<span class="fc" id="L581">      return ret;</span>
    }
<span class="nc" id="L583">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L584">      e.printStackTrace();</span>
    }
<span class="nc" id="L586">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getMeasurements(org.wattdepot
   * .datamodel.Depository, org.wattdepot.datamodel.SensorGroup, java.util.Date,
   * java.util.Date)
   */
  @Override
  public MeasurementList getMeasurements(Depository depository, SensorGroup group, Date start,
      Date end) {
    try {
<span class="fc" id="L600">      ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
          + depository.getId() + &quot;/&quot; + Labels.MEASUREMENTS + &quot;/&quot; + &quot;?sensor=&quot; + group.getId()
          + &quot;&amp;start=&quot; + DateConvert.convertDate(start) + &quot;&amp;end=&quot; + DateConvert.convertDate(end));
<span class="fc" id="L603">      DepositoryMeasurementsResource resource = client.wrap(DepositoryMeasurementsResource.class);</span>
<span class="fc" id="L604">      MeasurementList ret = resource.retrieve();</span>
<span class="fc" id="L605">      client.release();</span>
<span class="fc" id="L606">      return ret;</span>
    }
<span class="nc" id="L608">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L609">      e.printStackTrace();</span>
    }
<span class="nc" id="L611">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getMeasurementType(java.lang.String
   * )
   */
  @Override
  public MeasurementType getMeasurementType(String id) throws IdNotFoundException {
<span class="fc" id="L623">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.MEASUREMENT_TYPE + &quot;/&quot; + id);</span>
<span class="fc" id="L624">    MeasurementTypeResource resource = client.wrap(MeasurementTypeResource.class);</span>
    try {
<span class="fc" id="L626">      MeasurementType ret = resource.retrieve();</span>
<span class="fc" id="L627">      client.release();</span>
<span class="fc" id="L628">      return ret;</span>
    }
<span class="fc" id="L630">    catch (ResourceException e) {</span>
<span class="fc" id="L631">      throw new IdNotFoundException(id + &quot; is not a known MeasurementType. &quot;);</span>
    }
    finally {
<span class="pc bpc" id="L634" title="2 of 4 branches missed.">      if (client != null) {</span>
<span class="fc" id="L635">        client.release();</span>
      }
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getMeasurementTypes()
   */
  @Override
  public MeasurementTypeList getMeasurementTypes() {
<span class="fc" id="L647">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.MEASUREMENT_TYPES + &quot;/&quot;);</span>
<span class="fc" id="L648">    MeasurementTypesResource resource = client.wrap(MeasurementTypesResource.class);</span>
<span class="fc" id="L649">    MeasurementTypeList ret = resource.retrieve();</span>
<span class="fc" id="L650">    client.release();</span>
<span class="fc" id="L651">    return ret;</span>
  }

  /**
   * @return the organization id.
   */
  public String getOrganizationId() {
<span class="fc" id="L658">    return organizationId;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getSensor(java.lang.String)
   */
  @Override
  public Sensor getSensor(String id) throws IdNotFoundException {
<span class="fc" id="L668">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR + &quot;/&quot; + id);</span>
<span class="fc" id="L669">    SensorResource resource = client.wrap(SensorResource.class);</span>
    try {
<span class="fc" id="L671">      Sensor ret = resource.retrieve();</span>
<span class="fc" id="L672">      client.release();</span>
<span class="fc" id="L673">      return ret;</span>
    }
<span class="fc" id="L675">    catch (ResourceException e) {</span>
<span class="fc" id="L676">      throw new IdNotFoundException(id + &quot; is not a known Sensor. &quot;);</span>
    }
    finally {
<span class="pc bpc" id="L679" title="2 of 4 branches missed.">      if (client != null) {</span>
<span class="fc" id="L680">        client.release();</span>
      }
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getSensorGroup(java.lang.String)
   */
  @Override
  public SensorGroup getSensorGroup(String id) throws IdNotFoundException {
<span class="fc" id="L693">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR_GROUP + &quot;/&quot; + id);</span>
<span class="fc" id="L694">    SensorGroupResource resource = client.wrap(SensorGroupResource.class);</span>
    try {
<span class="fc" id="L696">      SensorGroup ret = resource.retrieve();</span>
<span class="fc" id="L697">      client.release();</span>
<span class="fc" id="L698">      return ret;</span>
    }
<span class="fc" id="L700">    catch (ResourceException e) {</span>
<span class="fc" id="L701">      throw new IdNotFoundException(id + &quot; is not a known SensorGroup. &quot;);</span>
    }
    finally {
<span class="pc bpc" id="L704" title="2 of 4 branches missed.">      if (client != null) {</span>
<span class="fc" id="L705">        client.release();</span>
      }
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getSensorGroups()
   */
  @Override
  public SensorGroupList getSensorGroups() {
<span class="fc" id="L717">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR_GROUPS + &quot;/&quot;);</span>
<span class="fc" id="L718">    SensorGroupsResource resource = client.wrap(SensorGroupsResource.class);</span>
<span class="fc" id="L719">    SensorGroupList ret = resource.retrieve();</span>
<span class="fc" id="L720">    client.release();</span>
<span class="fc" id="L721">    return ret;</span>

  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getSensorModel(java.lang.String)
   */
  @Override
  public SensorModel getSensorModel(String id) throws IdNotFoundException {
<span class="fc" id="L733">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.SENSOR_MODEL + &quot;/&quot; + id);</span>
<span class="fc" id="L734">    SensorModelResource resource = client.wrap(SensorModelResource.class);</span>
    try {
<span class="fc" id="L736">      SensorModel ret = resource.retrieve();</span>
<span class="fc" id="L737">      client.release();</span>
<span class="fc" id="L738">      return ret;</span>
    }
<span class="fc" id="L740">    catch (ResourceException e) {</span>
<span class="fc" id="L741">      throw new IdNotFoundException(id + &quot; is not a known SensorModel. &quot;);</span>
    }
    finally {
<span class="pc bpc" id="L744" title="2 of 4 branches missed.">      if (client != null) {</span>
<span class="fc" id="L745">        client.release();</span>
      }
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getSensorModels()
   */
  @Override
  public SensorModelList getSensorModels() {
<span class="fc" id="L757">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.SENSOR_MODELS + &quot;/&quot;);</span>
<span class="fc" id="L758">    SensorModelsResource resource = client.wrap(SensorModelsResource.class);</span>
<span class="fc" id="L759">    SensorModelList ret = resource.retrieve();</span>
<span class="fc" id="L760">    client.release();</span>
<span class="fc" id="L761">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getSensors()
   */
  @Override
  public SensorList getSensors() {
<span class="fc" id="L771">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSORS + &quot;/&quot;);</span>
<span class="fc" id="L772">    SensorsResource resource = client.wrap(SensorsResource.class);</span>
<span class="fc" id="L773">    SensorList ret = resource.retrieve();</span>
<span class="fc" id="L774">    client.release();</span>
<span class="fc" id="L775">    return ret;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.datamodel
   * .Depository, org.wattdepot.datamodel.Sensor, java.util.Date)
   */
  @Override
  public Double getValue(Depository depository, Sensor sensor, Date timestamp)
      throws NoMeasurementException {
<span class="fc" id="L788">    ClientResource client = null;</span>
    try {
<span class="fc" id="L790">      client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + depository.getId()</span>
          + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + sensor.getId() + &quot;&amp;timestamp=&quot;
          + DateConvert.convertDate(timestamp));
<span class="fc" id="L793">      DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L794">      InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L795">      client.release();</span>
<span class="pc bpc" id="L796" title="1 of 2 branches missed.">      if (ret != null) {</span>
<span class="fc" id="L797">        return ret.getValue();</span>
      }
    }
<span class="nc" id="L800">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L801">      throw new NoMeasurementException(e.getMessage());</span>
    }
    finally {
<span class="pc bpc" id="L804" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L805">        client.release();</span>
      }
    }
<span class="nc" id="L808">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.datamodel
   * .Depository, org.wattdepot.datamodel.Sensor, java.util.Date,
   * java.util.Date)
   */
  @Override
  public Double getValue(Depository depository, Sensor sensor, Date start, Date end)
      throws NoMeasurementException {
<span class="fc" id="L822">    ClientResource client = null;</span>
    try {
<span class="fc" id="L824">      client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + depository.getId()</span>
          + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + sensor.getId() + &quot;&amp;start=&quot;
          + DateConvert.convertDate(start) + &quot;&amp;end=&quot; + DateConvert.convertDate(end));
<span class="fc" id="L827">      DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L828">      InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L829">      client.release();</span>
<span class="fc" id="L830">      return ret.getValue();</span>
    }
<span class="nc" id="L832">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L833">      e.printStackTrace();</span>
    }
    finally {
<span class="pc bpc" id="L836" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L837">        client.release();</span>
      }
    }
<span class="nc" id="L840">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.datamodel
   * .Depository, org.wattdepot.datamodel.Sensor, java.util.Date,
   * java.util.Date, java.lang.Long)
   */
  @Override
  public Double getValue(Depository depository, Sensor sensor, Date start, Date end, Long gapSeconds)
      throws NoMeasurementException, MeasurementGapException {
<span class="fc" id="L854">    ClientResource client = null;</span>
    try {
<span class="fc" id="L856">      client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + depository.getId()</span>
          + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + sensor.getId() + &quot;&amp;start=&quot;
          + DateConvert.convertDate(start) + &quot;&amp;end=&quot; + DateConvert.convertDate(end) + &quot;&amp;gap=&quot;
          + gapSeconds);
<span class="fc" id="L860">      DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L861">      InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L862">      client.release();</span>
<span class="fc" id="L863">      return ret.getValue();</span>
    }
<span class="nc" id="L865">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L866">      e.printStackTrace();</span>
    }
    finally {
<span class="pc bpc" id="L869" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L870">        client.release();</span>
      }
    }
<span class="nc" id="L873">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.datamodel
   * .Depository, org.wattdepot.datamodel.Sensor, java.util.Date,
   * java.lang.Long)
   */
  @Override
  public Double getValue(Depository depository, Sensor sensor, Date timestamp, Long gapSeconds)
      throws NoMeasurementException, MeasurementGapException {
<span class="fc" id="L887">    ClientResource client = null;</span>
    try {
<span class="fc" id="L889">      client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + depository.getId()</span>
          + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + sensor.getId() + &quot;&amp;timestamp=&quot;
          + DateConvert.convertDate(timestamp) + &quot;&amp;gap=&quot; + gapSeconds);
<span class="fc" id="L892">      DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L893">      InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L894">      client.release();</span>
<span class="fc" id="L895">      return ret.getValue();</span>
    }
<span class="nc" id="L897">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L898">      e.printStackTrace();</span>
    }
    finally {
<span class="pc bpc" id="L901" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L902">        client.release();</span>
      }
    }
<span class="nc" id="L905">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.datamodel
   * .Depository, org.wattdepot.datamodel.SensorGroup, java.util.Date)
   */
  @Override
  public Double getValue(Depository depository, SensorGroup group, Date timestamp)
      throws NoMeasurementException {
<span class="fc" id="L918">    ClientResource client = null;</span>
    try {
<span class="fc" id="L920">      client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + depository.getId()</span>
          + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + group.getId() + &quot;&amp;timestamp=&quot;
          + DateConvert.convertDate(timestamp));
<span class="fc" id="L923">      DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L924">      InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L925">      client.release();</span>
<span class="pc bpc" id="L926" title="1 of 2 branches missed.">      if (ret != null) {</span>
<span class="fc" id="L927">        return ret.getValue();</span>
      }
    }
<span class="nc" id="L930">    catch (ResourceException re) {</span>
<span class="nc" id="L931">      throw new NoMeasurementException(re.getMessage());</span>
    }
<span class="nc" id="L933">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L934">      throw new NoMeasurementException(e.getMessage());</span>
    }
    finally {
<span class="pc bpc" id="L937" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L938">        client.release();</span>
      }
    }
<span class="nc" id="L941">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.common.
   * domainmodel.Depository, org.wattdepot.common.domainmodel.SensorGroup,
   * java.util.Date, java.util.Date)
   */
  @Override
  public Double getValue(Depository depository, SensorGroup group, Date start, Date end)
      throws NoMeasurementException {
<span class="fc" id="L954">    ClientResource client = null;</span>
    try {
<span class="fc" id="L956">      client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + depository.getId()</span>
          + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + group.getId() + &quot;&amp;start=&quot;
          + DateConvert.convertDate(start) + &quot;&amp;end=&quot; + DateConvert.convertDate(end));
<span class="fc" id="L959">      DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L960">      InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L961">      client.release();</span>
<span class="fc" id="L962">      return ret.getValue();</span>
    }
<span class="nc" id="L964">    catch (ResourceException re) {</span>
<span class="nc" id="L965">      throw new  NoMeasurementException(re.getCause());</span>
    }
<span class="nc" id="L967">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L968">      e.printStackTrace();</span>
    }
    finally {
<span class="pc bpc" id="L971" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L972">        client.release();</span>
      }
    }
<span class="nc" id="L975">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.common.
   * domainmodel.Depository, org.wattdepot.common.domainmodel.SensorGroup,
   * java.util.Date, java.util.Date, java.lang.Long)
   */
  @Override
  public Double getValue(Depository depository, SensorGroup group, Date start, Date end,
      Long gapSeconds) throws NoMeasurementException, MeasurementGapException {
<span class="fc" id="L988">    ClientResource client = null;</span>
    try {
<span class="fc" id="L990">      client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + depository.getId()</span>
          + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + group.getId() + &quot;&amp;start=&quot;
          + DateConvert.convertDate(start) + &quot;&amp;end=&quot; + DateConvert.convertDate(end) + &quot;&amp;gap=&quot;
          + gapSeconds);
<span class="fc" id="L994">      DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="fc" id="L995">      InterpolatedValue ret = resource.retrieve();</span>
<span class="fc" id="L996">      client.release();</span>
<span class="fc" id="L997">      return ret.getValue();</span>
    }
<span class="nc" id="L999">    catch (ResourceException re) {</span>
<span class="nc" id="L1000">      throw new MeasurementGapException(re.getCause());</span>
    }
<span class="nc" id="L1002">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L1003">      e.printStackTrace();</span>
    }
    finally {
<span class="pc bpc" id="L1006" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L1007">        client.release();</span>
      }
    }
<span class="nc" id="L1010">    return null;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.common.
   * domainmodel.Depository, org.wattdepot.common.domainmodel.SensorGroup,
   * java.util.Date, java.lang.Long)
   */
  @Override
  public Double getValue(Depository depository, SensorGroup group, Date timestamp, Long gapSeconds)
      throws NoMeasurementException, MeasurementGapException {
<span class="fc" id="L1023">    ClientResource client = null;</span>
    try {
<span class="nc" id="L1025">      client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot; + depository.getId()</span>
          + &quot;/&quot; + Labels.VALUE + &quot;/&quot; + &quot;?sensor=&quot; + group.getId() + &quot;&amp;timestamp=&quot;
          + DateConvert.convertDate(timestamp) + &quot;&amp;gap=&quot; + gapSeconds);
<span class="nc" id="L1028">      DepositoryValueResource resource = client.wrap(DepositoryValueResource.class);</span>
<span class="nc" id="L1029">      InterpolatedValue ret = resource.retrieve();</span>
<span class="nc" id="L1030">      client.release();</span>
<span class="nc" id="L1031">      return ret.getValue();</span>
    }
<span class="fc" id="L1033">    catch (ResourceException e1) {</span>
<span class="fc" id="L1034">      throw new MeasurementGapException(e1.getCause());</span>
    }
<span class="nc" id="L1036">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L1037">      e.printStackTrace();</span>
    }
    finally {
<span class="pc bpc" id="L1040" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L1041">        client.release();</span>
      }
    }
<span class="nc" id="L1044">    return null;</span>
  }

  /*
   * (non-Javadoc)
   *
   * @see org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.common.
   * domainmodel.Depository, org.wattdepot.common.domainmodel.Sensor,
   * java.util.Date, java.util.Date, java.lang.Integer, java.lang.Boolean)
   */
  @Override
  public InterpolatedValueList getValues(Depository depository, Sensor sensor, Date start, Date end, Integer interval, Boolean usePointValues) throws NoMeasurementException {
<span class="fc" id="L1056">    ClientResource client = null;</span>
    try {
<span class="fc" id="L1058">      StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L1059">      sb.append(this.organizationId);</span>
<span class="fc" id="L1060">      sb.append(&quot;/&quot;);</span>
<span class="fc" id="L1061">      sb.append(Labels.DEPOSITORY);</span>
<span class="fc" id="L1062">      sb.append(&quot;/&quot;);</span>
<span class="fc" id="L1063">      sb.append(depository.getId());</span>
<span class="fc" id="L1064">      sb.append(&quot;/&quot;);</span>
<span class="fc" id="L1065">      sb.append(Labels.VALUES);</span>
<span class="fc" id="L1066">      sb.append(&quot;/?&quot;);</span>
<span class="fc" id="L1067">      sb.append(Labels.SENSOR);</span>
<span class="fc" id="L1068">      sb.append(&quot;=&quot;);</span>
<span class="fc" id="L1069">      sb.append(sensor.getId());</span>
<span class="fc" id="L1070">      sb.append(&quot;&amp;&quot;);</span>
<span class="fc" id="L1071">      sb.append(Labels.START);</span>
<span class="fc" id="L1072">      sb.append(&quot;=&quot;);</span>
<span class="fc" id="L1073">      sb.append(DateConvert.convertDate(start));</span>
<span class="fc" id="L1074">      sb.append(&quot;&amp;&quot;);</span>
<span class="fc" id="L1075">      sb.append(Labels.END);</span>
<span class="fc" id="L1076">      sb.append(&quot;=&quot;);</span>
<span class="fc" id="L1077">      sb.append(DateConvert.convertDate(end));</span>
<span class="fc" id="L1078">      sb.append(&quot;&amp;&quot;);</span>
<span class="fc" id="L1079">      sb.append(Labels.INTERVAL);</span>
<span class="fc" id="L1080">      sb.append(&quot;=&quot;);</span>
<span class="fc" id="L1081">      sb.append(interval);</span>
<span class="fc" id="L1082">      sb.append(&quot;&amp;&quot;);</span>
<span class="fc" id="L1083">      sb.append(Labels.VALUE_TYPE);</span>
<span class="fc" id="L1084">      sb.append(&quot;=&quot;);</span>
<span class="fc bfc" id="L1085" title="All 2 branches covered.">      if (usePointValues) {</span>
<span class="fc" id="L1086">        sb.append(Labels.POINT);</span>
      }
      else {
<span class="fc" id="L1089">        sb.append(Labels.DIFFERENCE);</span>
      }
<span class="fc" id="L1091">      client = makeClient(sb.toString());</span>
<span class="fc" id="L1092">      DepositoryValuesResource resource = client.wrap(DepositoryValuesResource.class);</span>
<span class="fc" id="L1093">      InterpolatedValueList ret = resource.retrieve();</span>
<span class="fc" id="L1094">      client.release();</span>
<span class="fc" id="L1095">      return ret;</span>
    }
<span class="nc" id="L1097">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L1098">      e.printStackTrace();</span>
    }
    finally {
<span class="pc bpc" id="L1101" title="5 of 6 branches missed.">      if (client != null) {</span>
<span class="pc" id="L1102">        client.release();</span>
      }
    }
<span class="nc" id="L1105">    return null;</span>
  }

  /*
   * (non-Javadoc)
   *
   * @see org.wattdepot.client.WattDepotInterface#getValue(org.wattdepot.common.
   * domainmodel.Depository, org.wattdepot.common.domainmodel.SensorGroup,
   * java.util.Date, java.util.Date, java.lang.Integer, java.lang.Boolean)
   */
  @Override
  public InterpolatedValueList getValues(Depository depository, SensorGroup group, Date start, Date end, Integer interval, Boolean usePointValues) throws NoMeasurementException {
<span class="nc" id="L1117">    ClientResource client = null;</span>
    try {
<span class="nc" id="L1119">      StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L1120">      sb.append(this.organizationId);</span>
<span class="nc" id="L1121">      sb.append(&quot;/&quot;);</span>
<span class="nc" id="L1122">      sb.append(Labels.DEPOSITORY);</span>
<span class="nc" id="L1123">      sb.append(&quot;/&quot;);</span>
<span class="nc" id="L1124">      sb.append(depository.getId());</span>
<span class="nc" id="L1125">      sb.append(&quot;/&quot;);</span>
<span class="nc" id="L1126">      sb.append(Labels.VALUES);</span>
<span class="nc" id="L1127">      sb.append(&quot;/?&quot;);</span>
<span class="nc" id="L1128">      sb.append(Labels.SENSOR);</span>
<span class="nc" id="L1129">      sb.append(&quot;=&quot;);</span>
<span class="nc" id="L1130">      sb.append(group.getId());</span>
<span class="nc" id="L1131">      sb.append(&quot;&amp;&quot;);</span>
<span class="nc" id="L1132">      sb.append(Labels.START);</span>
<span class="nc" id="L1133">      sb.append(&quot;=&quot;);</span>
<span class="nc" id="L1134">      sb.append(DateConvert.convertDate(start));</span>
<span class="nc" id="L1135">      sb.append(&quot;&amp;&quot;);</span>
<span class="nc" id="L1136">      sb.append(Labels.END);</span>
<span class="nc" id="L1137">      sb.append(&quot;=&quot;);</span>
<span class="nc" id="L1138">      sb.append(DateConvert.convertDate(end));</span>
<span class="nc" id="L1139">      sb.append(&quot;&amp;&quot;);</span>
<span class="nc" id="L1140">      sb.append(Labels.INTERVAL);</span>
<span class="nc" id="L1141">      sb.append(&quot;=&quot;);</span>
<span class="nc" id="L1142">      sb.append(interval);</span>
<span class="nc" id="L1143">      sb.append(&quot;&amp;&quot;);</span>
<span class="nc" id="L1144">      sb.append(Labels.VALUE_TYPE);</span>
<span class="nc" id="L1145">      sb.append(&quot;=&quot;);</span>
<span class="nc bnc" id="L1146" title="All 2 branches missed.">      if (usePointValues) {</span>
<span class="nc" id="L1147">        sb.append(Labels.POINT);</span>
      }
      else {
<span class="nc" id="L1150">        sb.append(Labels.DIFFERENCE);</span>
      }
<span class="nc" id="L1152">      client = makeClient(sb.toString());</span>
<span class="nc" id="L1153">      DepositoryValuesResource resource = client.wrap(DepositoryValuesResource.class);</span>
<span class="nc" id="L1154">      InterpolatedValueList ret = resource.retrieve();</span>
<span class="nc" id="L1155">      client.release();</span>
<span class="nc" id="L1156">      return ret;</span>
    }
<span class="nc" id="L1158">    catch (DatatypeConfigurationException e) {</span>
<span class="nc" id="L1159">      e.printStackTrace();</span>
    }
    finally {
<span class="nc bnc" id="L1162" title="All 6 branches missed.">      if (client != null) {</span>
<span class="nc" id="L1163">        client.release();</span>
      }
    }
<span class="nc" id="L1166">    return null;</span>
  }

  /**
   * @return the wattDepotUri
   */
  public String getWattDepotUri() {
<span class="fc" id="L1173">    return wattDepotUri;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#isDefinedCollectorProcessDefinition
   * (java.lang.String)
   */
  @Override
  public boolean isDefinedCollectorProcessDefinition(String id) {
    try {
<span class="fc" id="L1186">      getCollectorProcessDefinition(id);</span>
<span class="fc" id="L1187">      return true;</span>
    }
<span class="nc" id="L1189">    catch (IdNotFoundException e) {</span>
<span class="nc" id="L1190">      return false;</span>
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#isDefinedDepository(java.lang.String
   * )
   */
  @Override
  public boolean isDefinedDepository(String id) {
    try {
<span class="fc" id="L1204">      getDepository(id);</span>
<span class="fc" id="L1205">      return true;</span>
    }
<span class="nc" id="L1207">    catch (IdNotFoundException e) {</span>
<span class="nc" id="L1208">      return false;</span>
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#isDefinedMeasurementPruningDefinition
   * (java.lang.String)
   */
  @Override
  public boolean isDefinedMeasurementPruningDefinition(String id) {
    try {
<span class="fc" id="L1222">      getMeasurementPruningDefinition(id);</span>
<span class="fc" id="L1223">      return true;</span>
    }
<span class="nc" id="L1225">    catch (IdNotFoundException idnf) {</span>
<span class="nc" id="L1226">      return false;</span>
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#isDefinedMeasurementType(java.lang
   * .String)
   */
  @Override
  public boolean isDefinedMeasurementType(String id) {
    try {
<span class="fc" id="L1240">      getMeasurementType(id);</span>
<span class="fc" id="L1241">      return true;</span>
    }
<span class="nc" id="L1243">    catch (IdNotFoundException e) {</span>
<span class="nc" id="L1244">      return false;</span>
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#isDefinedSensor(java.lang.String)
   */
  @Override
  public boolean isDefinedSensor(String id) {
    try {
<span class="fc" id="L1257">      getSensor(id);</span>
<span class="fc" id="L1258">      return true;</span>
    }
<span class="nc" id="L1260">    catch (IdNotFoundException e) {</span>
<span class="nc" id="L1261">      return false;</span>
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#isDefinedSensorGroup(java.lang.
   * String)
   */
  @Override
  public boolean isDefinedSensorGroup(String id) {
    try {
<span class="fc" id="L1275">      getSensorGroup(id);</span>
<span class="fc" id="L1276">      return true;</span>
    }
<span class="nc" id="L1278">    catch (IdNotFoundException e) {</span>
<span class="nc" id="L1279">      return false;</span>
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#isDefinedSensorModel(java.lang.
   * String)
   */
  @Override
  public boolean isDefinedSensorModel(String id) {
    try {
<span class="fc" id="L1293">      getSensorModel(id);</span>
<span class="fc" id="L1294">      return true;</span>
    }
<span class="nc" id="L1296">    catch (IdNotFoundException e) {</span>
<span class="nc" id="L1297">      return false;</span>
    }
  }

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#isHealthy()
   */
  @Override
  public boolean isHealthy() {
<span class="fc" id="L1308">    ClientResource client = makeClient(&quot;&quot;);</span>
<span class="fc" id="L1309">    client.head();</span>
<span class="fc" id="L1310">    boolean healthy = client.getStatus().isSuccess();</span>
<span class="fc" id="L1311">    client.release();</span>
<span class="fc" id="L1312">    return healthy;</span>
  }

  /**
   * Creates a ClientResource for the given request. Calling code MUST release
   * the ClientResource when finished.
   * 
   * @param requestString A String, the request portion of the WattDepot HTTP
   *        API, such as &quot;
   * @return The client resource.
   */
  public ClientResource makeClient(String requestString) {
<span class="fc" id="L1324">    logger.fine(this.wattDepotUri + requestString);</span>
<span class="fc" id="L1325">    Reference reference = new Reference(this.wattDepotUri + requestString);</span>
<span class="fc" id="L1326">    ClientResource client = new ClientResource(reference);</span>
<span class="fc" id="L1327">    client.setChallengeResponse(authentication);</span>
<span class="fc" id="L1328">    return client;</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#putCollectorProcessDefinition(org
   * .wattdepot .datamodel.CollectorProcessDefinition)
   */
  @Override
  public void putCollectorProcessDefinition(CollectorProcessDefinition process) {
<span class="fc" id="L1340">    ClientResource client = makeClient(this.organizationId + &quot;/&quot;</span>
        + Labels.COLLECTOR_PROCESS_DEFINITION + &quot;/&quot;);
<span class="fc" id="L1342">    CollectorProcessDefinitionPutResource resource = client</span>
        .wrap(CollectorProcessDefinitionPutResource.class);
    try {
<span class="fc" id="L1345">      resource.store(process);</span>
    }
    finally {
<span class="pc" id="L1348">      client.release();</span>
<span class="fc" id="L1349">    }</span>
<span class="fc" id="L1350">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#putDepository(org.wattdepot.datamodel
   * .Depository)
   */
  @Override
  public void putDepository(Depository depository) {
<span class="fc" id="L1361">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;);</span>
<span class="fc" id="L1362">    DepositoryPutResource resource = client.wrap(DepositoryPutResource.class);</span>
    try {
<span class="fc" id="L1364">      resource.store(depository);</span>
    }
    finally {
<span class="fc" id="L1367">      client.release();</span>
<span class="fc" id="L1368">    }</span>
<span class="fc" id="L1369">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#putMeasurementPruningDefinition(
   * org.wattdepot.common.domainmodel.MeasurementPruningDefinition)
   */
  @Override
  public void putMeasurementPruningDefinition(MeasurementPruningDefinition gcd) {
<span class="fc" id="L1380">    String url = this.organizationId + &quot;/&quot;</span>
        + Labels.MEASUREMENT_PRUNING_DEFINITION + &quot;/&quot;;
<span class="fc" id="L1382">    ClientResource client = makeClient(url);</span>
<span class="fc" id="L1383">    MeasurementPruningDefinitionPutResource resource = client</span>
        .wrap(MeasurementPruningDefinitionPutResource.class);
    try {
<span class="fc" id="L1386">      resource.store(gcd);</span>
    }
    finally {
<span class="fc" id="L1389">      client.release();</span>
<span class="fc" id="L1390">    }</span>
<span class="fc" id="L1391">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#putMeasurement(org.wattdepot.
   * datamodel.Depository, org.wattdepot.datamodel.Measurement)
   */
  @Override
  public void putMeasurement(Depository depository, Measurement measurement)
      throws MeasurementTypeException {
<span class="fc bfc" id="L1402" title="All 2 branches covered.">    if (!depository.getMeasurementType().getUnits().equals(measurement.getMeasurementType())) {</span>
<span class="fc" id="L1403">      throw new MeasurementTypeException(&quot;Depository &quot; + depository.getName() + &quot; stores &quot;</span>
          + depository.getMeasurementType() + &quot; not &quot; + measurement.getMeasurementType());
    }
<span class="fc" id="L1406">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.DEPOSITORY + &quot;/&quot;</span>
        + depository.getId() + &quot;/&quot; + Labels.MEASUREMENT + &quot;/&quot;);
<span class="fc" id="L1408">    DepositoryMeasurementPutResource resource = client.wrap(DepositoryMeasurementPutResource.class);</span>
    try {
<span class="fc" id="L1410">      resource.store(measurement);</span>
    }
    finally {
<span class="pc" id="L1413">      client.release();</span>
<span class="fc" id="L1414">    }</span>
<span class="fc" id="L1415">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#putMeasurementType(org.wattdepot
   * .datamodel.MeasurementType)
   */
  @Override
  public void putMeasurementType(MeasurementType type) {
<span class="fc" id="L1426">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.MEASUREMENT_TYPE + &quot;/&quot;);</span>
<span class="fc" id="L1427">    MeasurementTypePutResource resource = client.wrap(MeasurementTypePutResource.class);</span>
    try {
<span class="fc" id="L1429">      resource.store(type);</span>
    }
    finally {
<span class="fc" id="L1432">      client.release();</span>
<span class="fc" id="L1433">    }</span>
<span class="fc" id="L1434">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#putSensor(org.wattdepot.datamodel
   * .Sensor)
   */
  @Override
  public void putSensor(Sensor sensor) {
<span class="fc" id="L1445">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR + &quot;/&quot;);</span>
<span class="fc" id="L1446">    SensorPutResource resource = client.wrap(SensorPutResource.class);</span>
    try {
<span class="fc" id="L1448">      resource.store(sensor);</span>
    }
    finally {
<span class="pc" id="L1451">      client.release();</span>
<span class="fc" id="L1452">    }</span>
<span class="fc" id="L1453">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#putSensorGroup(org.wattdepot.
   * datamodel.SensorGroup)
   */
  @Override
  public void putSensorGroup(SensorGroup group) {
<span class="fc" id="L1463">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR_GROUP + &quot;/&quot;);</span>
<span class="fc" id="L1464">    SensorGroupPutResource resource = client.wrap(SensorGroupPutResource.class);</span>
    try {
<span class="fc" id="L1466">      resource.store(group);</span>
    }
    finally {
<span class="fc" id="L1469">      client.release();</span>
<span class="fc" id="L1470">    }</span>
<span class="fc" id="L1471">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#putSensorModel(org.wattdepot.
   * datamodel.SensorModel)
   */
  @Override
  public void putSensorModel(SensorModel model) {
<span class="fc" id="L1481">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.SENSOR_MODEL + &quot;/&quot;);</span>
<span class="fc" id="L1482">    SensorModelPutResource resource = client.wrap(SensorModelPutResource.class);</span>
    try {
<span class="fc" id="L1484">      resource.store(model);</span>
    }
    finally {
<span class="pc" id="L1487">      client.release();</span>
<span class="fc" id="L1488">    }</span>
<span class="fc" id="L1489">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#updateCollectorProcessDefinition
   * (org.wattdepot .datamodel.CollectorProcessDefinition)
   */
  @Override
  public void updateCollectorProcessDefinition(CollectorProcessDefinition process) {
<span class="fc" id="L1500">    ClientResource client = makeClient(this.organizationId + &quot;/&quot;</span>
        + Labels.COLLECTOR_PROCESS_DEFINITION + &quot;/&quot; + process.getId());
<span class="fc" id="L1502">    CollectorProcessDefinitionResource resource = client</span>
        .wrap(CollectorProcessDefinitionResource.class);
    try {
<span class="nc" id="L1505">      resource.update(process);</span>
    }
    finally {
<span class="pc" id="L1508">      client.release();</span>
<span class="nc" id="L1509">    }</span>
<span class="nc" id="L1510">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see org.wattdepot.client.WattDepotInterface#updateDepository(org.wattdepot
   * .datamodel.Depository)
   */
  @Override
  public void updateDepository(Depository depository) {
<span class="fc" id="L1520">    throw new RuntimeException(&quot;Can't update an existing Depository.&quot;);</span>
  }

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#updateMeasurementPruningDefinition
   * (org.wattdepot.common.domainmodel.MeasurementPruningDefinition)
   */
  @Override
  public void updateMeasurementPruningDefinition(MeasurementPruningDefinition gcd) {
<span class="fc" id="L1532">    ClientResource client = makeClient(this.organizationId + &quot;/&quot;</span>
        + Labels.MEASUREMENT_PRUNING_DEFINITION + &quot;/&quot; + gcd.getId());
<span class="fc" id="L1534">    MeasurementPruningDefinitionResource resource = client</span>
        .wrap(MeasurementPruningDefinitionResource.class);
    try {
<span class="nc" id="L1537">      resource.update(gcd);</span>
    }
    finally {
<span class="pc" id="L1540">      client.release();</span>
<span class="nc" id="L1541">    }</span>
<span class="nc" id="L1542">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#updateMeasurementType(org.wattdepot
   * .datamodel.MeasurementType)
   */
  @Override
  public void updateMeasurementType(MeasurementType type) {
<span class="fc" id="L1553">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.MEASUREMENT_TYPE + &quot;/&quot;</span>
        + type.getId());
<span class="fc" id="L1555">    MeasurementTypeResource resource = client.wrap(MeasurementTypeResource.class);</span>
    try {
<span class="fc" id="L1557">      resource.update(type);</span>
    }
    finally {
<span class="fc" id="L1560">      client.release();</span>
<span class="fc" id="L1561">    }</span>
<span class="fc" id="L1562">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#updateSensor(org.wattdepot.datamodel
   * .Sensor)
   */
  @Override
  public void updateSensor(Sensor sensor) {
<span class="fc" id="L1573">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR + &quot;/&quot;</span>
        + sensor.getId());
<span class="fc" id="L1575">    SensorResource resource = client.wrap(SensorResource.class);</span>
    try {
<span class="fc" id="L1577">      resource.update(sensor);</span>
    }
    finally {
<span class="pc" id="L1580">      client.release();</span>
<span class="fc" id="L1581">    }</span>
<span class="fc" id="L1582">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#updateSensorGroup(org.wattdepot
   * .datamodel.SensorGroup)
   */
  @Override
  public void updateSensorGroup(SensorGroup group) {
<span class="fc" id="L1593">    ClientResource client = makeClient(this.organizationId + &quot;/&quot; + Labels.SENSOR_GROUP + &quot;/&quot;</span>
        + group.getId());
<span class="fc" id="L1595">    SensorGroupResource resource = client.wrap(SensorGroupResource.class);</span>
    try {
<span class="fc" id="L1597">      resource.update(group);</span>
    }
    finally {
<span class="pc" id="L1600">      client.release();</span>
<span class="fc" id="L1601">    }</span>
<span class="fc" id="L1602">  }</span>

  /*
   * (non-Javadoc)
   * 
   * @see
   * org.wattdepot.client.WattDepotInterface#updateSensorModel(org.wattdepot
   * .datamodel.SensorModel)
   */
  @Override
  public void updateSensorModel(SensorModel model) {
<span class="fc" id="L1613">    ClientResource client = makeClient(Labels.PUBLIC + &quot;/&quot; + Labels.SENSOR_MODEL + &quot;/&quot;</span>
        + model.getId());
<span class="fc" id="L1615">    SensorModelResource resource = client.wrap(SensorModelResource.class);</span>
    try {
<span class="fc" id="L1617">      resource.update(model);</span>
    }
    finally {
<span class="pc" id="L1620">      client.release();</span>
<span class="fc" id="L1621">    }</span>
<span class="fc" id="L1622">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>